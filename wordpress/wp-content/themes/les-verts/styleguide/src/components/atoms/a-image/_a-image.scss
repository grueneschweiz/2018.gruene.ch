@use "sass:math";
@use "../../../scss/variables" as v;
@use "../../../scss/mixins" as m;

.a-image {
	max-width: 100%;
	position: relative;
	line-height: 0;

	&__image {
		transition: transform v.$transition-mid v.$transition-ease-image;
	}

	&__image--no-crop {
		max-width: 100%;
	}

	&--cover {
		width: 100%;
		height: 100%;
	}

	&--cover &__image {
		width: 100%;
		height: 100%;
	}

	&--cover &__lazy-wrapper {
		width: 100%;
		height: 100%;
		overflow: hidden;
	}

	&--cover.object-fit-ie {
		background-size: cover;
	}

	&__image--lazy {
		filter: blur(2vw);
		transform: scale(1.1);
	}

	&__image--loaded {
		animation-name: reveal;
		animation-duration: v.$transition-mid;
		animation-timing-function: v.$transition-ease-image;
	}

	&--cover &__image--fp {
		object-fit: cover;

		&-top {
			&-left {
				object-position: 0 0;
			}

			&-center {
				object-position: 50% 0;
			}

			&-right {
				object-position: 100% 0;
			}
		}

		&-middle {
			&-left {
				object-position: 0 50%;
			}

			&-center {
				object-position: 50% 50%;
			}

			&-right {
				object-position: 100% 50%;
			}
		}

		&-bottom {
			&-left {
				object-position: 0 100%;
			}

			&-center {
				object-position: 50% 100%;
			}

			&-right {
				object-position: 100% 100%;
			}
		}

		&.object-fit-ie {
			display: none;
		}
	}

	// for the IE polyfill
	&--cover.object-fit-ie.a-image__image-fp {
		&-top {
			&-left {
				background-position: 0 0;
			}

			&-center {
				background-position: 50% 0;
			}

			&-right {
				background-position: 100% 0;
			}
		}

		&-middle {
			&-left {
				background-position: 0 50%;
			}

			&-center {
				background-position: 50% 50%;
			}

			&-right {
				background-position: 100% 50%;
			}
		}

		&-bottom {
			&-left {
				background-position: 0 100%;
			}

			&-center {
				background-position: 50% 100%;
			}

			&-right {
				background-position: 100% 100%;
			}
		}
	}

	&__link {
		@include m.clean-link;

		& {
			display: block;
			max-width: 100%;
			overflow: hidden;
		}

		@include m.hover {
			.a-image__image {
				transform: scale(1.01);
			}
		}
	}

	&--cover &__link {
		width: 100%;
		height: 100%;
	}

	&__copy {
		position: absolute;
		@include m.fluid-props(bottom right, v.$size-tiny, v.$size-large, 5px, 10px);
		@include m.fluid-props(font-size, v.$size-tiny, v.$size-large, 5px, 7px);
		
		&::before { // Empty pseudo-element to avoid mixed declarations warnings
			content: "";
			display: none;
		}
		
		& {
			transform: translateX(calc(100% - 1em)) rotate(-90deg);
			transform-origin: top left;
			color: v.$color-white;
			text-transform: uppercase;
			mix-blend-mode: difference;
		}

		&--caption {
			transform: none;
			color: v.$color-text-light;
			mix-blend-mode: normal;
		}

		&--small {
			bottom: 6px;
			right: 3px;
			font-size: 6px;
		}

		a {
			box-shadow: none;
			color: inherit;
			text-decoration: none;

			@include m.hover {
				background: none;
				box-shadow: none;
			}
		}
	}

	&__caption {
		line-height: 1.4em;
		font-size: 0.875rem;
		color: v.$color-text-light;
		padding: 0.5em 1em 1em;
		background: v.$color-grey-1;
		width: 100%;
		display: block;
	}
}

@keyframes reveal {
	0%   {filter: blur(2vw); transform: scale(1.1);}
	100% {filter: blur(0); transform: scale(1);}
};

.no-js .a-image--cover .a-image__lazy-wrapper {
	display: none;
}
